<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Journal</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.10.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.10.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.10.0/favicon_green.png" />
    <link rel="icon" type="image/png" href="./assets/0.10.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.10.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2016-03-08T13:23:34-07:00">2016-03-08T13:23:34-07:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="green">94.92%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         4947.13
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>31</b> files in total.
    <b>649</b> relevant lines. 
    <span class="green"><b>616</b> lines covered</span> and
    <span class="red"><b>33</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#4ca69b96cfb783311001d4954d2c4fbf8ca218e0" class="src_link" title="app/controllers/api/v1/alert_analytics_controller.rb">app/controllers/api/v1/alert_analytics_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5ca68fa1538e745f94000f7839c99b3000990302" class="src_link" title="app/controllers/api/v1/emotions_controller.rb">app/controllers/api/v1/emotions_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>27</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>1.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4614db316c60988f1abce890f6a076030c87119a" class="src_link" title="app/controllers/api/v1/journal_entries_controller.rb">app/controllers/api/v1/journal_entries_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>30</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>4.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7c0d7e7361b0ea52a71ac4e8d859364ddb3e1173" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>42</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>6.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a2b62427816e4bbd7789ed9b55d03074db45a115" class="src_link" title="app/controllers/dashboards_controller.rb">app/controllers/dashboards_controller.rb</a></td>
        <td class="red strong">53.85 %</td>
        <td>53</td>
        <td>26</td>
        <td>14</td>
        <td>12</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e9da425eeee492ac53088557aba54dea9c5a0cde" class="src_link" title="app/controllers/home_controller.rb">app/controllers/home_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7cbf5e1a7ee24d74dbc155097279b1f7b6954fe0" class="src_link" title="app/controllers/journal_entries_controller.rb">app/controllers/journal_entries_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7ca878e445a11ac4c5d90ac7af964b3022aeb72b" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>22</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#575150876c3f23cc305d8e8d93e51a27affb065f" class="src_link" title="app/models/app_message.rb">app/models/app_message.rb</a></td>
        <td class="red strong">72.73 %</td>
        <td>21</td>
        <td>11</td>
        <td>8</td>
        <td>3</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#82e9fed738309b87387be9a352aa456f935a7495" class="src_link" title="app/models/auth.rb">app/models/auth.rb</a></td>
        <td class="green strong">93.33 %</td>
        <td>27</td>
        <td>15</td>
        <td>14</td>
        <td>1</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b9858b69a04447139f52c9f62c1c2c2fa8f93d5d" class="src_link" title="app/models/bayes_suicide_classifier.rb">app/models/bayes_suicide_classifier.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>39</td>
        <td>14</td>
        <td>14</td>
        <td>0</td>
        <td>3.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1ced45ac75e7c142642a6e0bf6d3ac9b5289aa36" class="src_link" title="app/models/chart_params_service.rb">app/models/chart_params_service.rb</a></td>
        <td class="red strong">42.86 %</td>
        <td>33</td>
        <td>21</td>
        <td>9</td>
        <td>12</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2036d408c6a860161dc69726c00fa7ebf178892b" class="src_link" title="app/models/chart_service.rb">app/models/chart_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>70</td>
        <td>38</td>
        <td>38</td>
        <td>0</td>
        <td>9.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#90a18f5c3a25fccc0d42e2b8a7239d813280e7df" class="src_link" title="app/models/concerns/direct_search_minimizer.rb">app/models/concerns/direct_search_minimizer.rb</a></td>
        <td class="green strong">98.94 %</td>
        <td>226</td>
        <td>94</td>
        <td>93</td>
        <td>1</td>
        <td>7876.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4b283182ee2218eba4ff5b60dc0b85ea0e0a59a2" class="src_link" title="app/models/concerns/nelder_mead.rb">app/models/concerns/nelder_mead.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>97</td>
        <td>58</td>
        <td>58</td>
        <td>0</td>
        <td>7452.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0774b99fd307926143922fcb5da8aad0816778a4" class="src_link" title="app/models/concerns/point_value_pair.rb">app/models/concerns/point_value_pair.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>11946.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#33df51cec7b01d7f10ec8c66d3c2bfd467caaa8f" class="src_link" title="app/models/concerns/user_helper.rb">app/models/concerns/user_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>40</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>11.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#983bc9d9b9feb0b3ab278dc6fdeb38f99ba9a55f" class="src_link" title="app/models/curve_fit.rb">app/models/curve_fit.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>45</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>80257.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1ba3280223f0885a80b98280b347ec914a620c3c" class="src_link" title="app/models/emotion.rb">app/models/emotion.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>22</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>7.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#99fd207cd5fb836c5ce1cfca3f99055b778bb8d0" class="src_link" title="app/models/emotion_prototype.rb">app/models/emotion_prototype.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>12</td>
        <td>8</td>
        <td>7</td>
        <td>1</td>
        <td>0.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9ef4d76889804f68a431d894bc60010255b93c14" class="src_link" title="app/models/google_service.rb">app/models/google_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#63fc95386bf76e71371fa3e738aaa8a1450b4d95" class="src_link" title="app/models/journal_entry.rb">app/models/journal_entry.rb</a></td>
        <td class="green strong">94.74 %</td>
        <td>40</td>
        <td>19</td>
        <td>18</td>
        <td>1</td>
        <td>23.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4c8245a3bb44644fd9e2af3996b5ba3caa3ec28b" class="src_link" title="app/models/permission_service.rb">app/models/permission_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>36</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>11.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#285730d87c85f41879232d74b034564f622bb167" class="src_link" title="app/models/reddit_miner.rb">app/models/reddit_miner.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>43</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>42.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fbeafc0cd74a88601ee9ae1527a099eab1b611a7" class="src_link" title="app/models/reflective_similarity.rb">app/models/reflective_similarity.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>7.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1e93be816a1a1ee9e174628439e95dbdc9a57c92" class="src_link" title="app/models/save_to_drive_service.rb">app/models/save_to_drive_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>36</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>2.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e81a6ea459c640d5b35dafd537985684808462ef" class="src_link" title="app/models/self_reflection.rb">app/models/self_reflection.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>51</td>
        <td>21</td>
        <td>21</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#58f1e469745e4a03f8240fe8cb26010f49c66a25" class="src_link" title="app/models/suicidal_entry_classifier.rb">app/models/suicidal_entry_classifier.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>31</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>3.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#33b97087ab77bae8f8b59345185cfda1e47c367c" class="src_link" title="app/models/training_post.rb">app/models/training_post.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>55.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ad590ca49807d86a550427908d38999572c9695a" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
        <td class="green strong">93.55 %</td>
        <td>50</td>
        <td>31</td>
        <td>29</td>
        <td>2</td>
        <td>14.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#05b0afe9e93fb9bf50d93ae78ca1a8c0051ae847" class="src_link" title="app/models/user_emotion_prototype.rb">app/models/user_emotion_prototype.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>13</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent"><span class="green">90.63%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         2.79
       </span>
    </span> hits/line)
  </h2>
  <a name="Controllers"></a>
  <div>
    <b>8</b> files in total.
    <b>128</b> relevant lines. 
    <span class="green"><b>116</b> lines covered</span> and
    <span class="red"><b>12</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#4ca69b96cfb783311001d4954d2c4fbf8ca218e0" class="src_link" title="app/controllers/api/v1/alert_analytics_controller.rb">app/controllers/api/v1/alert_analytics_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5ca68fa1538e745f94000f7839c99b3000990302" class="src_link" title="app/controllers/api/v1/emotions_controller.rb">app/controllers/api/v1/emotions_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>27</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>1.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4614db316c60988f1abce890f6a076030c87119a" class="src_link" title="app/controllers/api/v1/journal_entries_controller.rb">app/controllers/api/v1/journal_entries_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>30</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>4.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7c0d7e7361b0ea52a71ac4e8d859364ddb3e1173" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>42</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>6.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a2b62427816e4bbd7789ed9b55d03074db45a115" class="src_link" title="app/controllers/dashboards_controller.rb">app/controllers/dashboards_controller.rb</a></td>
        <td class="red strong">53.85 %</td>
        <td>53</td>
        <td>26</td>
        <td>14</td>
        <td>12</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e9da425eeee492ac53088557aba54dea9c5a0cde" class="src_link" title="app/controllers/home_controller.rb">app/controllers/home_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7cbf5e1a7ee24d74dbc155097279b1f7b6954fe0" class="src_link" title="app/controllers/journal_entries_controller.rb">app/controllers/journal_entries_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7ca878e445a11ac4c5d90ac7af964b3022aeb72b" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>22</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent"><span class="green">95.97%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         6161.87
       </span>
    </span> hits/line)
  </h2>
  <a name="Models"></a>
  <div>
    <b>23</b> files in total.
    <b>521</b> relevant lines. 
    <span class="green"><b>500</b> lines covered</span> and
    <span class="red"><b>21</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#575150876c3f23cc305d8e8d93e51a27affb065f" class="src_link" title="app/models/app_message.rb">app/models/app_message.rb</a></td>
        <td class="red strong">72.73 %</td>
        <td>21</td>
        <td>11</td>
        <td>8</td>
        <td>3</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#82e9fed738309b87387be9a352aa456f935a7495" class="src_link" title="app/models/auth.rb">app/models/auth.rb</a></td>
        <td class="green strong">93.33 %</td>
        <td>27</td>
        <td>15</td>
        <td>14</td>
        <td>1</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b9858b69a04447139f52c9f62c1c2c2fa8f93d5d" class="src_link" title="app/models/bayes_suicide_classifier.rb">app/models/bayes_suicide_classifier.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>39</td>
        <td>14</td>
        <td>14</td>
        <td>0</td>
        <td>3.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1ced45ac75e7c142642a6e0bf6d3ac9b5289aa36" class="src_link" title="app/models/chart_params_service.rb">app/models/chart_params_service.rb</a></td>
        <td class="red strong">42.86 %</td>
        <td>33</td>
        <td>21</td>
        <td>9</td>
        <td>12</td>
        <td>0.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2036d408c6a860161dc69726c00fa7ebf178892b" class="src_link" title="app/models/chart_service.rb">app/models/chart_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>70</td>
        <td>38</td>
        <td>38</td>
        <td>0</td>
        <td>9.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#90a18f5c3a25fccc0d42e2b8a7239d813280e7df" class="src_link" title="app/models/concerns/direct_search_minimizer.rb">app/models/concerns/direct_search_minimizer.rb</a></td>
        <td class="green strong">98.94 %</td>
        <td>226</td>
        <td>94</td>
        <td>93</td>
        <td>1</td>
        <td>7876.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4b283182ee2218eba4ff5b60dc0b85ea0e0a59a2" class="src_link" title="app/models/concerns/nelder_mead.rb">app/models/concerns/nelder_mead.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>97</td>
        <td>58</td>
        <td>58</td>
        <td>0</td>
        <td>7452.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0774b99fd307926143922fcb5da8aad0816778a4" class="src_link" title="app/models/concerns/point_value_pair.rb">app/models/concerns/point_value_pair.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>11946.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#33df51cec7b01d7f10ec8c66d3c2bfd467caaa8f" class="src_link" title="app/models/concerns/user_helper.rb">app/models/concerns/user_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>40</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>11.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#983bc9d9b9feb0b3ab278dc6fdeb38f99ba9a55f" class="src_link" title="app/models/curve_fit.rb">app/models/curve_fit.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>45</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>80257.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1ba3280223f0885a80b98280b347ec914a620c3c" class="src_link" title="app/models/emotion.rb">app/models/emotion.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>22</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>7.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#99fd207cd5fb836c5ce1cfca3f99055b778bb8d0" class="src_link" title="app/models/emotion_prototype.rb">app/models/emotion_prototype.rb</a></td>
        <td class="yellow strong">87.5 %</td>
        <td>12</td>
        <td>8</td>
        <td>7</td>
        <td>1</td>
        <td>0.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9ef4d76889804f68a431d894bc60010255b93c14" class="src_link" title="app/models/google_service.rb">app/models/google_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>3.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#63fc95386bf76e71371fa3e738aaa8a1450b4d95" class="src_link" title="app/models/journal_entry.rb">app/models/journal_entry.rb</a></td>
        <td class="green strong">94.74 %</td>
        <td>40</td>
        <td>19</td>
        <td>18</td>
        <td>1</td>
        <td>23.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4c8245a3bb44644fd9e2af3996b5ba3caa3ec28b" class="src_link" title="app/models/permission_service.rb">app/models/permission_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>36</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>11.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#285730d87c85f41879232d74b034564f622bb167" class="src_link" title="app/models/reddit_miner.rb">app/models/reddit_miner.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>43</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>42.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fbeafc0cd74a88601ee9ae1527a099eab1b611a7" class="src_link" title="app/models/reflective_similarity.rb">app/models/reflective_similarity.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>7.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1e93be816a1a1ee9e174628439e95dbdc9a57c92" class="src_link" title="app/models/save_to_drive_service.rb">app/models/save_to_drive_service.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>36</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>2.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e81a6ea459c640d5b35dafd537985684808462ef" class="src_link" title="app/models/self_reflection.rb">app/models/self_reflection.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>51</td>
        <td>21</td>
        <td>21</td>
        <td>0</td>
        <td>2.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#58f1e469745e4a03f8240fe8cb26010f49c66a25" class="src_link" title="app/models/suicidal_entry_classifier.rb">app/models/suicidal_entry_classifier.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>31</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>3.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#33b97087ab77bae8f8b59345185cfda1e47c367c" class="src_link" title="app/models/training_post.rb">app/models/training_post.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>55.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ad590ca49807d86a550427908d38999572c9695a" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
        <td class="green strong">93.55 %</td>
        <td>50</td>
        <td>31</td>
        <td>29</td>
        <td>2</td>
        <td>14.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#05b0afe9e93fb9bf50d93ae78ca1a8c0051ae847" class="src_link" title="app/models/user_emotion_prototype.rb">app/models/user_emotion_prototype.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>13</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Mailers"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Helpers"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Jobs"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Libraries"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.11.2 
        and simplecov-html v0.10.0<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="4ca69b96cfb783311001d4954d2c4fbf8ca218e0">
  <div class="header">
    <h3>app/controllers/api/v1/alert_analytics_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Api::V1::AlertAnalyticsController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    sc = SuicidalEntryClassifier.new(classifier_params)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    reply = sc.troubled?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    if reply</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      current_user.app_messages.create(message: AppMessage.national_suicide_prevention_hotline, status: 1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    render json: {reply: reply}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def classifier_params</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    params.permit!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    params.except(&quot;controller&quot;,&quot;action&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5ca68fa1538e745f94000f7839c99b3000990302">
  <div class="header">
    <h3>app/controllers/api/v1/emotions_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Api::V1::EmotionsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="3">
          <span class="hits">4</span>
          
          <code class="ruby">    if default_emotion = current_user.inactive_emotion_prototypes.find{|emp| emp.name == params[&quot;name&quot;]}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">      current_user.set_emotion_prototype(&quot;active&quot;, params[&quot;name&quot;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">      render json: {reply: &quot;created&quot;, color: default_emotion.color, description: default_emotion.description}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">      emotion = current_user.emotion_prototypes.create(name: params[&quot;name&quot;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">                                       description: params[&quot;description&quot;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">                                             color: &quot;rgb(200,200,200)&quot;)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">       if !emotion.id.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">         render json: {reply: &quot;created&quot;, color: &quot;rgb(200,200,200)&quot;, description: params[&quot;description&quot;]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">       else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">         render json: {reply: emotion.errors.full_messages}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">       end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="19">
          <span class="hits">9</span>
          
          <code class="ruby">    emotion = current_user.active_emotion_prototypes.find{|emp| emp.name == params[&quot;id&quot;]}</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">    if emotion</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      current_user.set_emotion_prototype(&quot;inactive&quot;, emotion.name)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">      render json: {reply: &quot;removed&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      render json: {reply: &quot;You didn&#39;t have that emotion listed...&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4614db316c60988f1abce890f6a076030c87119a">
  <div class="header">
    <h3>app/controllers/api/v1/journal_entries_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Api::V1::JournalEntriesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="3">
          <span class="hits">5</span>
          
          <code class="ruby">    user_id = current_user.id</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="4">
          <span class="hits">5</span>
          
          <code class="ruby">    if journal_params[&quot;user_id&quot;].to_i == user_id</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="5">
          <span class="hits">4</span>
          
          <code class="ruby">      save = SaveToDriveService.new(google_service, user_id)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="6">
          <span class="hits">4</span>
          
          <code class="ruby">      reply = save.post_file_to_drive(params[:tag], params[:body])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="7">
          <span class="hits">4</span>
          
          <code class="ruby">      @entry = JournalEntry.create(tag: params[:tag],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">                               file_id: reply.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">                               user_id: user_id)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="10">
          <span class="hits">4</span>
          
          <code class="ruby">      process_emotion_params</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">      render json: {created: &quot;success&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">      render json: {created: &quot;error&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def journal_params</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="20">
          <span class="hits">9</span>
          
          <code class="ruby">    params.permit!</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="21">
          <span class="hits">9</span>
          
          <code class="ruby">    params.except(&quot;tag&quot;,&quot;body&quot;,&quot;controller&quot;,&quot;action&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def process_emotion_params</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="25">
          <span class="hits">4</span>
          
          <code class="ruby">    journal_params.except(&quot;user_id&quot;).each do |emotion, score|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="26">
          <span class="hits">15</span>
          
          <code class="ruby">      proto = current_user.emotion_prototypes.find_by(name: emotion)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="27">
          <span class="hits">15</span>
          
          <code class="ruby">      @entry.emotions.create(emotion_prototype: proto, score: score)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7c0d7e7361b0ea52a71ac4e8d859364ddb3e1173">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;google/apis/drive_v2&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  protect_from_forgery with: :exception</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  helper_method :current_user, :google_service, :user_info</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :authorize!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def auth</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="10">
          <span class="hits">6</span>
          
          <code class="ruby">    @ac ||= Auth.new( {&quot;access_token&quot; =&gt; access_token} )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def google_service</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="14">
          <span class="hits">6</span>
          
          <code class="ruby">    @gs ||= GoogleService.new( auth, {&quot;user_info&quot; =&gt; user_info} )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_user</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="18">
          <span class="hits">9</span>
          
          <code class="ruby">    @current_user ||= User.find_or_create_by_auth(google_service.user_info) if access_token</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def authorize!</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="22">
          <span class="hits">33</span>
          
          <code class="ruby">    @ps = PermissionService.new(current_user)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="23">
          <span class="hits">33</span>
          
          <code class="ruby">    permission = @ps.allow?(params[:controller], params[:action])</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="24">
          <span class="hits">33</span>
          
          <code class="ruby">    unless permission[0]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to permission[1]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def access_token</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="32">
          <span class="hits">11</span>
          
          <code class="ruby">    session[:access_token]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_info</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="36">
          <span class="hits">6</span>
          
          <code class="ruby">    session[:user_info]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def code</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    params[:code]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a2b62427816e4bbd7789ed9b55d03074db45a115">
  <div class="header">
    <h3>app/controllers/dashboards_controller.rb</h3>
    <h4><span class="red">53.85 %</span> covered</h4>
    <div>
      <b>26</b> relevant lines. 
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class DashboardsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include ChartParamsService</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="5">
          <span class="hits">5</span>
          
          <code class="ruby">    render layout: &#39;wide&#39;,  :locals =&gt; {:background =&gt; &quot;dashboard3&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="9">
          <span class="hits">3</span>
          
          <code class="ruby">    cs = ChartService.new(current_user)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="10">
          <span class="hits">3</span>
          
          <code class="ruby">    if current_user.journal_entries?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      cs.get_emotion_data_from_user(datetime_params[0], datetime_params[1])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="13">
          <span class="hits">3</span>
          
          <code class="ruby">    @chart = cs.render_dashboard_plot</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="15">
          <span class="hits">3</span>
          
          <code class="ruby">    if comparison_graph?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      cs2 = ChartService.new(current_user, {title: &quot;#{emotion_names}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      y_title: &quot;&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      x_min: time_interval[:start],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      x_max: time_interval[:end]})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="21">
          
          
          <code class="ruby">      cs2.get_emotion_data_from_user_for(emotion_params,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">                                        datetime_params[0],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">                                        datetime_params[1])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">      sr = SelfReflection.new(current_user)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">      interval = params[&quot;emotions&quot;][&quot;days&quot;].to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">      emo = emotion_params.first</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="28">
          
          
          <code class="ruby">      comparisons = sr.distances_between_journal_and_journal_span(emo, interval.day)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="29">
          
          
          <code class="ruby">      comparisons &lt;&lt; [0,0]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="30">
          
          
          <code class="ruby">      start, fin = comparisons.first[1], comparisons.first[1] + interval.day</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">      cs3 = ChartService.new(current_user, {title: &quot;Time similar to current #{emo.name}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      y_title: &quot;&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      x_min: start.to_i * 1000,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      x_max: fin.to_i * 1000})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="37">
          
          
          <code class="ruby">      cs3.get_emotion_data_from_user_for(emotion_params,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">                                        datetime_params[0],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">                                        datetime_params[1])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="41">
          
          
          <code class="ruby">      @chart3 = cs3.render_dashboard_plot</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">      @chart2 = cs2.render_dashboard_plot</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="45">
          <span class="hits">3</span>
          
          <code class="ruby">    render layout: &#39;wide&#39;,  :locals =&gt; {:background =&gt; &quot;dashboard3&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def comparison_graph?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="51">
          <span class="hits">3</span>
          
          <code class="ruby">    !!params[&quot;emotions&quot;] &amp;&amp; !!params[&quot;emotions&quot;][&quot;days&quot;] &amp;&amp; !emotion_params.empty? &amp;&amp; current_user.has_journal_entries?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e9da425eeee492ac53088557aba54dea9c5a0cde">
  <div class="header">
    <h3>app/controllers/home_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class HomeController &lt; ApplicationController</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def home</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="4">
          <span class="hits">2</span>
          
          <code class="ruby">    render layout: &#39;wide&#39;,  :locals =&gt; {:background =&gt; &quot;home&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7cbf5e1a7ee24d74dbc155097279b1f7b6954fe0">
  <div class="header">
    <h3>app/controllers/journal_entries_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>17</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;google/apis/drive_v2&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;google/api_client/client_secrets&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">class JournalEntriesController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="6">
          <span class="hits">2</span>
          
          <code class="ruby">    @entries = current_user.journal_entries</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    render layout: &#39;wide&#39;,  :locals =&gt; {:background =&gt; &quot;dashboard3&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">    @entry = JournalEntry.new(user: current_user)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="12">
          <span class="hits">4</span>
          
          <code class="ruby">    render layout: &#39;wide&#39;,  :locals =&gt; {:background =&gt; &quot;dashboard3&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def show</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    entry = JournalEntry.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    file_name = &quot;#{current_user.id}:#{entry.file_id}.txt&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    google_service.drive.get_file(entry.file_id, download_dest: file_name)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    file_contents = File.open(file_name, &#39;r&#39;).read</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    File.delete(file_name)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    @journal_entry = {entry: entry, body: file_contents, :empty? =&gt; file_contents.empty?}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    render layout: &#39;wide&#39;,  :locals =&gt; {:background =&gt; &quot;dashboard3&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7ca878e445a11ac4c5d90ac7af964b3022aeb72b">
  <div class="header">
    <h3>app/controllers/sessions_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;google/api_client/client_secrets&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">class SessionsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    auth_uri = google_service.auth_client.authorization_uri.to_s</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_to auth_uri</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    session.clear</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_to root_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">    auth = Auth.new( {&quot;code&quot; =&gt; code} )</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    session[:access_token] = auth.client.access_token</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    service = GoogleService.new(auth, {&quot;access_token&quot; =&gt; access_token})</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    session[:user_info] = service.user_info</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    current_user.app_messages.set_all_inactive if current_user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_to dashboard_path</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="575150876c3f23cc305d8e8d93e51a27affb065f">
  <div class="header">
    <h3>app/models/app_message.rb</h3>
    <h4><span class="red">72.73 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class AppMessage &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.national_suicide_prevention_hotline</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    &quot;Everyone feels down sometimes.  If you feel you may be a danger to&quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    &quot; yourself, please consider contacting the National Suicide Prevention&quot; +</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    &quot; Hotline at 1 (800) 273-8255.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.current_message</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="11">
          <span class="hits">11</span>
          
          <code class="ruby">    note = last</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="12">
          <span class="hits">11</span>
          
          <code class="ruby">    note.message if note &amp;&amp; note.status == 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.set_all_inactive</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    all.each do |note|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">      note.status = 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="18">
          
          
          <code class="ruby">      note.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="82e9fed738309b87387be9a352aa456f935a7495">
  <div class="header">
    <h3>app/models/auth.rb</h3>
    <h4><span class="green">93.33 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;google/apis/drive_v2&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;google/api_client/client_secrets&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">class Auth</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :client</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  #three options: takes in {code =&gt; code}, or {access_token =&gt; access_token}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(opts)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="9">
          <span class="hits">7</span>
          
          <code class="ruby">    @client = set_auth_client(opts)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="10">
          <span class="hits">7</span>
          
          <code class="ruby">    set_access_token if client.code</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_auth_client(opts)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="14">
          <span class="hits">7</span>
          
          <code class="ruby">    client_secrets = Google::APIClient::ClientSecrets.load &#39;google/api_client/client_secrets.json&#39;</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="15">
          <span class="hits">7</span>
          
          <code class="ruby">    auth_client = client_secrets.to_authorization</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="16">
          <span class="hits">7</span>
          
          <code class="ruby">    auth_client.update!(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      :scope =&gt; &#39;https://www.googleapis.com/auth/drive&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      :redirect_uri =&gt; &#39;http://localhost:3000/google_api/auth&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    )</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="20">
          <span class="hits">7</span>
          
          <code class="ruby">    auth_client.code, auth_client.access_token = opts[&quot;code&quot;], opts[&quot;access_token&quot;]</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="21">
          <span class="hits">7</span>
          
          <code class="ruby">    auth_client</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_access_token</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    client.fetch_access_token!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b9858b69a04447139f52c9f62c1c2c2fa8f93d5d">
  <div class="header">
    <h3>app/models/bayes_suicide_classifier.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>14</b> relevant lines. 
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class BayesSuicideClassifier</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def classifier</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="3">
          <span class="hits">7</span>
          
          <code class="ruby">    @@classifier ||= train_on_training_posts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def train_on_training_posts</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="7">
          <span class="hits">4</span>
          
          <code class="ruby">    classy = Classifier::Bayes.new &#39;Ok&#39;, &#39;Troubled&#39;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="8">
          <span class="hits">4</span>
          
          <code class="ruby">    TrainingPost.all.each do |tp|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="9">
          <span class="hits">8</span>
          
          <code class="ruby">      classy.send(keys_to_methods[tp.classification.downcase], tp.entry)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">    classy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def reset_classifier</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="15">
          <span class="hits">4</span>
          
          <code class="ruby">    @@classifier = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def classify(string)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="19">
          <span class="hits">4</span>
          
          <code class="ruby">    classifier.classify(string)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def keys_to_methods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      &quot;ok&quot; =&gt; :train_ok,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      &quot;troubled&quot; =&gt; :train_troubled</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="26">
          <span class="hits">8</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  # def train_on_db</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  #   classy = Classifier::Bayes.new &#39;ok&#39;, &#39;troubled&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  #   classy.categories = WatchClassifier.first.categories</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  #   classy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"># class Classifier::Bayes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">#   attr_reader :total_words, :categories</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">#   attr_accessor :category_counts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"># end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1ced45ac75e7c142642a6e0bf6d3ac9b5289aa36">
  <div class="header">
    <h3>app/models/chart_params_service.rb</h3>
    <h4><span class="red">42.86 %</span> covered</h4>
    <div>
      <b>21</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>12</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ChartParamsService</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def datetime_params</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="3">
          <span class="hits">2</span>
          
          <code class="ruby">    if (start = params[&quot;start_date&quot;]) &amp;&amp; (finish = params[&quot;end_date&quot;])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">      start_date = Time.strptime(start, &quot;%m/%d/%Y&quot;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="5">
          
          
          <code class="ruby">      end_date =  Time.strptime(finish, &quot;%m/%d/%Y&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">      start_date = current_user.first_entry_date</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="8">
          <span class="hits">2</span>
          
          <code class="ruby">      end_date =  current_user.last_entry_date</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">      [start_date, end_date]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def emotion_params</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="14">
          
          
          <code class="ruby">    return [] unless params[&quot;emotions&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    params[&quot;emotions&quot;].to_a.map do |emotion, value|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">      if value.to_i == 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">        current_user.active_emotion_prototypes.find{|emp| emp.name == emotion}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="19">
          
          
          <code class="ruby">    end.compact</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def time_interval</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="23">
          
          
          <code class="ruby">    return {start: nil, end: nil} unless params[&quot;emotions&quot;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    num = params[&quot;emotions&quot;][&quot;days&quot;].to_i</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    end_time = current_user.last_entry_date</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="26">
          
          
          <code class="ruby">    start_time = end_time - num.days</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="27">
          
          
          <code class="ruby">    {start: start_time.to_i * 1000, end: end_time.to_i * 1000}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def emotion_names</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="31">
          
          
          <code class="ruby">    emotion_params.map{|emp| emp.name}.join(&quot;, &quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2036d408c6a860161dc69726c00fa7ebf178892b">
  <div class="header">
    <h3>app/models/chart_service.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>38</b> relevant lines. 
      <span class="green"><b>38</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ChartService</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :emotion_data, :colors, :id, :user, :opts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(user, opts = {})</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="5">
          <span class="hits">14</span>
          
          <code class="ruby">    @user = user</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="6">
          <span class="hits">14</span>
          
          <code class="ruby">    @id = user.id</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="7">
          <span class="hits">14</span>
          
          <code class="ruby">    @colors = []</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="8">
          <span class="hits">14</span>
          
          <code class="ruby">    @emotion_data = {@id =&gt; []}</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="9">
          <span class="hits">14</span>
          
          <code class="ruby">    @opts = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">      title: &quot;Emotions over Time&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">      y_title: &quot;Emotion Scores&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      x_min: nil,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      x_max: nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    }.merge(opts)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_emotion_data_from_user(start_time = nil, end_time = nil)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="18">
          <span class="hits">3</span>
          
          <code class="ruby">    start_time ||= user.journal_entries.first.created_at - 1.day</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="19">
          <span class="hits">3</span>
          
          <code class="ruby">    end_time ||= user.journal_entries.last.created_at + 1.day</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="20">
          <span class="hits">3</span>
          
          <code class="ruby">    @emotion_data = user.chart_emotion_data(start_time, end_time)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_emotion_data_from_user_for(emotion_protos, start_time=nil, end_time=nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">    start_time ||= user.journal_entries.first.created_at - 1.day</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">    end_time ||= user.journal_entries.last.created_at + 1.day</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="26">
          <span class="hits">2</span>
          
          <code class="ruby">    @emotion_data = user.chart_emotion_data(start_time, end_time, emotion_protos)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_dashboard_plot</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="30">
          <span class="hits">4</span>
          
          <code class="ruby">    LazyHighCharts::HighChart.new(&#39;line&#39;) do |f|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="31">
          <span class="hits">4</span>
          
          <code class="ruby">      emotion_data[id].each do |emotion_name, color_scores|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="32">
          <span class="hits">9</span>
          
          <code class="ruby">        f.series(name: emotion_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">                yAxis: 0,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">                 data: relabel(color_scores[:scores]),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">                 dataLabels: {enabled: true, format: &quot;{name}&quot;})</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="36">
          <span class="hits">9</span>
          
          <code class="ruby">        colors &lt;&lt; color_scores[:color]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="38">
          <span class="hits">4</span>
          
          <code class="ruby">      dashboard_plot_styling(f)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  def dashboard_plot_styling(f)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="43">
          <span class="hits">4</span>
          
          <code class="ruby">    f.title(text: opts[:title], align: &quot;center&quot;, style: {color: &#39;#EAD9C3&#39;, fontSize: &quot;large&quot;})</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="44">
          <span class="hits">4</span>
          
          <code class="ruby">    f.xAxis(type: &#39;datetime&#39;, min: opts[:x_min], max: opts[:x_max])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="45">
          <span class="hits">4</span>
          
          <code class="ruby">    f.colors(colors)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="46">
          <span class="hits">4</span>
          
          <code class="ruby">    f.yAxis [</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      {title: {text: opts[:y_title], margin: 10, style: {fontSize: &quot;medium&quot;, color: &#39;#EAD9C3&#39;} }, min:0, max: 10 , gridLineColor: &quot;rgb(70,70,70)&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    ]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="49">
          <span class="hits">4</span>
          
          <code class="ruby">    f.legend(align: &#39;right&#39;, verticalAlign: &#39;top&#39;, y: 75, x: -50, layout: &#39;vertical&#39;, backgroundColor: &quot;rgba(75,75,75,0)&quot; , itemStyle: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      color: &#39;#EAD9C3&#39;})</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="51">
          <span class="hits">4</span>
          
          <code class="ruby">    f.chart({defaultSeriesType: &quot;line&quot;, backgroundColor: &quot;rgba(0,0,0,0.65)&quot;})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">  def relabel(scores)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="55">
          <span class="hits">10</span>
          
          <code class="ruby">    dict = {created_at: :x, score: :y, tag: :name}</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="56">
          <span class="hits">10</span>
          
          <code class="ruby">    scores.compact.map do |hash|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      hash.map do |k,v|</code>
        </li>
      
        <li class="covered" data-hits="60" data-linenumber="58">
          <span class="hits">60</span>
          
          <code class="ruby">        [dict[k],adjust_date_times(v)]</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="59">
          <span class="hits">20</span>
          
          <code class="ruby">      end.to_h</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def adjust_date_times(dt)</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="64">
          <span class="hits">63</span>
          
          <code class="ruby">    if dt.class == ActiveSupport::TimeWithZone</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="65">
          <span class="hits">21</span>
          
          <code class="ruby">      (dt.to_f * 1000).to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="67">
          <span class="hits">42</span>
          
          <code class="ruby">      dt</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="90a18f5c3a25fccc0d42e2b8a7239d813280e7df">
  <div class="header">
    <h3>app/models/concerns/direct_search_minimizer.rb</h3>
    <h4><span class="green">98.94 %</span> covered</h4>
    <div>
      <b>94</b> relevant lines. 
      <span class="green"><b>93</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># = nelder_mead.rb -</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Minimization- Minimization algorithms on pure Ruby</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># Copyright (C) 2010 Claudio Bustos</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"># This program is free software; you can redistribute it and/or</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"># modify it under the terms of the GNU General Public License</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"># as published by the Free Software Foundation; either version 2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"># of the License, or (at your option) any later version.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"># This program is distributed in the hope that it will be useful,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"># but WITHOUT ANY WARRANTY; without even the implied warranty of</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"># GNU General Public License for more details.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"># You should have received a copy of the GNU General Public License</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"># along with this program; if not, write to the Free Software</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"># Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"># This algorith was adopted and ported into Ruby from Apache-commons</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"># Math library&#39;s NelderMead.java file. Therefore this file is under</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"># Apache License Version 2.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">#</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"># Nelder Mead Algorithm for Multidimensional minimization</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;#{File.expand_path(File.dirname(__FILE__))}/point_value_pair.rb&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  class DirectSearchMinimizer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    EPSILON_DEFAULT         = 1e-6</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    MAX_ITERATIONS_DEFAULT  = 1000000</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :x_minimum</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :f_minimum</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :epsilon</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(f, start_point, iterate_simplex_ref)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="37">
          <span class="hits">14</span>
          
          <code class="ruby">      @epsilon             = EPSILON_DEFAULT</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      # Default number of maximum iterations</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="39">
          <span class="hits">14</span>
          
          <code class="ruby">      @max_iterations      = MAX_ITERATIONS_DEFAULT</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      # proc which iterates the simplex</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="41">
          <span class="hits">14</span>
          
          <code class="ruby">      @iterate_simplex_ref = iterate_simplex_ref</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="42">
          <span class="hits">14</span>
          
          <code class="ruby">      @relative_threshold  = 100 * @epsilon</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="43">
          <span class="hits">14</span>
          
          <code class="ruby">      @absolute_threshold  = @epsilon</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="44">
          <span class="hits">14</span>
          
          <code class="ruby">      @x_minimum           = nil</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="45">
          <span class="hits">14</span>
          
          <code class="ruby">      @f_minimum           = nil</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="46">
          <span class="hits">14</span>
          
          <code class="ruby">      @f = f</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      # create and initializ start configurations</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="49">
          <span class="hits">14</span>
          
          <code class="ruby">      if @start_configuration == nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">        # sets the start configuration point as unit</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="51">
          <span class="hits">68</span>
          
          <code class="ruby">        self.start_configuration = Array.new(start_point.length) { 1.0 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="54">
          <span class="hits">14</span>
          
          <code class="ruby">      @iterations  = 0</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="55">
          <span class="hits">14</span>
          
          <code class="ruby">      @evaluations = 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      # create the simplex for the first time</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="57">
          <span class="hits">14</span>
          
          <code class="ruby">      build_simplex(start_point)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="58">
          <span class="hits">14</span>
          
          <code class="ruby">      evaluate_simplex</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">    def f(x)</code>
        </li>
      
        <li class="covered" data-hits="53267" data-linenumber="62">
          <span class="hits">53267</span>
          
          <code class="ruby">      return @f.call(x)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">    def iterate_simplex</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="66">
          
          
          <code class="ruby">      return iterate_simplex_ref.call</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    # increment iteration counter by 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">    def increment_iterations_counter</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="71">
          <span class="hits">8209</span>
          
          <code class="ruby">      @iterations += 1</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="72">
          <span class="hits">8209</span>
          
          <code class="ruby">      raise &quot;iteration limit reached&quot; if @iterations &gt; @max_iterations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    # compares 2 PointValuePair points</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">    def compare(v1, v2)</code>
        </li>
      
        <li class="covered" data-hits="66050" data-linenumber="77">
          <span class="hits">66050</span>
          
          <code class="ruby">      if v1.value == v2.value</code>
        </li>
      
        <li class="covered" data-hits="256" data-linenumber="78">
          <span class="hits">256</span>
          
          <code class="ruby">        return 0</code>
        </li>
      
        <li class="covered" data-hits="65794" data-linenumber="79">
          <span class="hits">65794</span>
          
          <code class="ruby">      elsif v1.value &gt; v2.value</code>
        </li>
      
        <li class="covered" data-hits="43490" data-linenumber="80">
          <span class="hits">43490</span>
          
          <code class="ruby">        return 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="22304" data-linenumber="82">
          <span class="hits">22304</span>
          
          <code class="ruby">        return -1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    # checks whether the function is converging</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">    def converging?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      # check the convergence in a given direction comparing the previous and current values</code>
        </li>
      
        <li class="covered" data-hits="8223" data-linenumber="89">
          <span class="hits">8223</span>
          
          <code class="ruby">      def point_converged?(previous, current)</code>
        </li>
      
        <li class="covered" data-hits="37681" data-linenumber="90">
          <span class="hits">37681</span>
          
          <code class="ruby">        pre        = previous.value</code>
        </li>
      
        <li class="covered" data-hits="37681" data-linenumber="91">
          <span class="hits">37681</span>
          
          <code class="ruby">        curr       = current.value</code>
        </li>
      
        <li class="covered" data-hits="37681" data-linenumber="92">
          <span class="hits">37681</span>
          
          <code class="ruby">        diff       = (pre - curr).abs</code>
        </li>
      
        <li class="covered" data-hits="37681" data-linenumber="93">
          <span class="hits">37681</span>
          
          <code class="ruby">        size       = [pre.abs, curr.abs].max</code>
        </li>
      
        <li class="covered" data-hits="37681" data-linenumber="94">
          <span class="hits">37681</span>
          
          <code class="ruby">        return !((diff &lt;= (size * @relative_threshold)) and (diff &lt;= @absolute_threshold))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">      # returns true if converging is possible atleast in one direction</code>
        </li>
      
        <li class="covered" data-hits="8223" data-linenumber="98">
          <span class="hits">8223</span>
          
          <code class="ruby">      if @iterations &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">        # given direction is converged</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="100">
          <span class="hits">8209</span>
          
          <code class="ruby">        converged = true</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="101">
          <span class="hits">8209</span>
          
          <code class="ruby">        0.upto(@simplex.length - 1) do |i|</code>
        </li>
      
        <li class="covered" data-hits="37681" data-linenumber="102">
          <span class="hits">37681</span>
          
          <code class="ruby">          converged &amp;= !point_converged?(@previous[i], @simplex[i])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="104">
          <span class="hits">8209</span>
          
          <code class="ruby">        return !converged</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      # if no iterations were done, convergence undefined</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="108">
          <span class="hits">14</span>
          
          <code class="ruby">      return true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">    # only the relative position of the n vertices with respect</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">    # to the first one are stored</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">    def start_configuration=(steps)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="114">
          <span class="hits">14</span>
          
          <code class="ruby">      n = steps.length</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="115">
          <span class="hits">68</span>
          
          <code class="ruby">      @start_configuration = Array.new(n) { Array.new(n, 0) }</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="116">
          <span class="hits">14</span>
          
          <code class="ruby">      0.upto(n - 1) do |i|</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="117">
          <span class="hits">54</span>
          
          <code class="ruby">        vertex_i = @start_configuration[i]</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="118">
          <span class="hits">54</span>
          
          <code class="ruby">        0.upto(i) do |j|</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="119">
          <span class="hits">144</span>
          
          <code class="ruby">          raise &quot;equals vertices #{j} and #{j+1} in simplex configuration&quot; if steps[j] == 0.0</code>
        </li>
      
        <li class="covered" data-hits="144" data-linenumber="120">
          <span class="hits">144</span>
          
          <code class="ruby">          0.upto(j) do |k|</code>
        </li>
      
        <li class="covered" data-hits="329" data-linenumber="121">
          <span class="hits">329</span>
          
          <code class="ruby">            vertex_i[k] = steps[k]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">    # Build an initial simplex</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">    # == Parameters:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">    # * &lt;tt&gt;start_point&lt;/tt&gt;: starting point of the minimization search</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="131">
          <span class="hits">1</span>
          
          <code class="ruby">    def build_simplex(start_point)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="132">
          <span class="hits">14</span>
          
          <code class="ruby">      n = start_point.length</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="133">
          <span class="hits">14</span>
          
          <code class="ruby">      raise &quot;dimension mismatch&quot; if n != @start_configuration.length</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">      # set first vertex</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="135">
          <span class="hits">14</span>
          
          <code class="ruby">      @simplex = Array.new(n+1)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="136">
          <span class="hits">14</span>
          
          <code class="ruby">      @simplex[0] = PointValuePair.new(start_point, Float::NAN)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">      # set remaining vertices</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="139">
          <span class="hits">14</span>
          
          <code class="ruby">      0.upto(n - 1) do |i|</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="140">
          <span class="hits">54</span>
          
          <code class="ruby">        conf_i   = @start_configuration[i]</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="141">
          <span class="hits">54</span>
          
          <code class="ruby">        vertex_i = Array.new(n)</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="142">
          <span class="hits">54</span>
          
          <code class="ruby">        0.upto(n - 1) do |k|</code>
        </li>
      
        <li class="covered" data-hits="234" data-linenumber="143">
          <span class="hits">234</span>
          
          <code class="ruby">          vertex_i[k] = start_point[k] + conf_i[k]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="145">
          <span class="hits">54</span>
          
          <code class="ruby">        @simplex[i + 1] = PointValuePair.new(vertex_i, Float::NAN)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">    # Evaluate all the non-evaluated points of the simplex</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="150">
          <span class="hits">1</span>
          
          <code class="ruby">    def evaluate_simplex</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">      # evaluate the objective function at all non-evaluated simplex points</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="152">
          <span class="hits">71</span>
          
          <code class="ruby">      0.upto(@simplex.length - 1) do |i|</code>
        </li>
      
        <li class="covered" data-hits="348" data-linenumber="153">
          <span class="hits">348</span>
          
          <code class="ruby">        vertex = @simplex[i]</code>
        </li>
      
        <li class="covered" data-hits="348" data-linenumber="154">
          <span class="hits">348</span>
          
          <code class="ruby">        point  = vertex.point</code>
        </li>
      
        <li class="covered" data-hits="348" data-linenumber="155">
          <span class="hits">348</span>
          
          <code class="ruby">        if vertex.value.nan?</code>
        </li>
      
        <li class="covered" data-hits="348" data-linenumber="156">
          <span class="hits">348</span>
          
          <code class="ruby">          @simplex[i] = PointValuePair.new(point, f(point))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">      # sort the simplex from best to worst</code>
        </li>
      
        <li class="covered" data-hits="498" data-linenumber="160">
          <span class="hits">498</span>
          
          <code class="ruby">      @simplex.sort!{ |x1, x2| x1.value &lt;=&gt; x2.value }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    # Replace the worst point of the simplex by a new point</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    # == Parameters:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">    # * &lt;tt&gt;point_value_pair&lt;/tt&gt;: point to insert</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">    def replace_worst_point(point_value_pair)</code>
        </li>
      
        <li class="covered" data-hits="8152" data-linenumber="168">
          <span class="hits">8152</span>
          
          <code class="ruby">      n = @simplex.length - 1</code>
        </li>
      
        <li class="covered" data-hits="8152" data-linenumber="169">
          <span class="hits">8152</span>
          
          <code class="ruby">      0.upto(n - 1) do |i|</code>
        </li>
      
        <li class="covered" data-hits="29249" data-linenumber="170">
          <span class="hits">29249</span>
          
          <code class="ruby">        if (compare(@simplex[i], point_value_pair) &gt; 0)</code>
        </li>
      
        <li class="covered" data-hits="23683" data-linenumber="171">
          <span class="hits">23683</span>
          
          <code class="ruby">          point_value_pair, @simplex[i] = @simplex[i], point_value_pair</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="8152" data-linenumber="174">
          <span class="hits">8152</span>
          
          <code class="ruby">      @simplex[n] = point_value_pair</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">    # Convenience method to minimize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">    # == Parameters:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">    # * &lt;tt&gt;start_point&lt;/tt&gt;: Starting points</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">    # * &lt;tt&gt;f&lt;/tt&gt;: Function to minimize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">    # == Usage:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">    #   minimizer=Minimization::NelderMead.minimize(proc{|x| (x[0] - 1) ** 2 + (x[1] - 5) ** 2}, [0, 0])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.minimize(f, start_point)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="185">
          <span class="hits">14</span>
          
          <code class="ruby">      min=NelderMead.new(f, start_point)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="186">
          <span class="hits">14</span>
          
          <code class="ruby">      while min.converging?</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="187">
          <span class="hits">8209</span>
          
          <code class="ruby">        min.iterate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="189">
          <span class="hits">14</span>
          
          <code class="ruby">      return min</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">    # Iterate the simplex one step. Use this when iteration needs to be done manually</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">    # == Usage:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">    #   minimizer=Minimization::NelderMead.new(proc{|x| (x[0] - 1) ** 2 + (x[1] - 5) ** 2}, [0, 0])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">    #   while minimizer.converging?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">    #     minimizer.Iterate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">    #   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">    #   minimizer.x_minimum</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">    #   minimizer.f_minimum</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">    def iterate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">      # set previous simplex as the current simplex</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="203">
          <span class="hits">8209</span>
          
          <code class="ruby">      @previous = Array.new(@simplex.length)</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="204">
          <span class="hits">8209</span>
          
          <code class="ruby">      0.upto(@simplex.length - 1) do |i|</code>
        </li>
      
        <li class="covered" data-hits="37681" data-linenumber="205">
          <span class="hits">37681</span>
          
          <code class="ruby">        point = @simplex[i].point                                # clone require?</code>
        </li>
      
        <li class="covered" data-hits="37681" data-linenumber="206">
          <span class="hits">37681</span>
          
          <code class="ruby">        @previous[i] = PointValuePair.new(point, f(point))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">      # iterate simplex</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="209">
          <span class="hits">8209</span>
          
          <code class="ruby">      iterate_simplex</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">      # set results</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="211">
          <span class="hits">8209</span>
          
          <code class="ruby">      @x_minimum = @simplex[0].point</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="212">
          <span class="hits">8209</span>
          
          <code class="ruby">      @f_minimum = @simplex[0].value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">  # = Nelder Mead Minimizer.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby">  # A multidimensional minimization methods.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">  # == Usage.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="219">
          
          
          <code class="ruby">  #  require &#39;minimization&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">  #  min=Minimization::NelderMead.new(proc {|x| (x[0] - 2)**2 + (x[1] - 5)**2}, [1, 2])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">  #  while min.converging?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">  #    min.iterate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">  #  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">  #  min.x_minimum</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">  #  min.f_minimum</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby">  #</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4b283182ee2218eba4ff5b60dc0b85ea0e0a59a2">
  <div class="header">
    <h3>app/models/concerns/nelder_mead.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>58</b> relevant lines. 
      <span class="green"><b>58</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">  class NelderMead &lt; DirectSearchMinimizer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(f, start_point)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">      # Reflection coefficient</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="4">
          <span class="hits">14</span>
          
          <code class="ruby">      @rho   = 1.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">      # Expansion coefficient</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="6">
          <span class="hits">14</span>
          
          <code class="ruby">      @khi   = 2.0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">      # Contraction coefficient</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="8">
          <span class="hits">14</span>
          
          <code class="ruby">      @gamma = 0.5</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">      # Shrinkage coefficient</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="10">
          <span class="hits">14</span>
          
          <code class="ruby">      @sigma = 0.5</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="11">
          <span class="hits">14</span>
          
          <code class="ruby">      super(f, start_point, proc{iterate_simplex})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def iterate_simplex</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="15">
          <span class="hits">8209</span>
          
          <code class="ruby">      increment_iterations_counter</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="16">
          <span class="hits">8209</span>
          
          <code class="ruby">      n = @simplex.length - 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      # the simplex has n+1 point if dimension is n</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="18">
          <span class="hits">8209</span>
          
          <code class="ruby">      best       = @simplex[0]</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="19">
          <span class="hits">8209</span>
          
          <code class="ruby">      secondBest = @simplex[n - 1]</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="20">
          <span class="hits">8209</span>
          
          <code class="ruby">      worst      = @simplex[n]</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="21">
          <span class="hits">8209</span>
          
          <code class="ruby">      x_worst    = worst.point</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="22">
          <span class="hits">8209</span>
          
          <code class="ruby">      centroid = Array.new(n, 0)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      # compute the centroid of the best vertices</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      # (dismissing the worst point at index n)</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="25">
          <span class="hits">8209</span>
          
          <code class="ruby">      0.upto(n - 1) do |i|</code>
        </li>
      
        <li class="covered" data-hits="29472" data-linenumber="26">
          <span class="hits">29472</span>
          
          <code class="ruby">        x = @simplex[i].point</code>
        </li>
      
        <li class="covered" data-hits="29472" data-linenumber="27">
          <span class="hits">29472</span>
          
          <code class="ruby">        0.upto(n - 1) do |j|</code>
        </li>
      
        <li class="covered" data-hits="116064" data-linenumber="28">
          <span class="hits">116064</span>
          
          <code class="ruby">          centroid[j] += x[j]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="31">
          <span class="hits">8209</span>
          
          <code class="ruby">      scaling = 1.0 / n</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="32">
          <span class="hits">8209</span>
          
          <code class="ruby">      0.upto(n - 1) do |j|</code>
        </li>
      
        <li class="covered" data-hits="29472" data-linenumber="33">
          <span class="hits">29472</span>
          
          <code class="ruby">        centroid[j] *= scaling</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="35">
          <span class="hits">8209</span>
          
          <code class="ruby">      xr = Array.new(n)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      # compute the reflection point</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="37">
          <span class="hits">8209</span>
          
          <code class="ruby">      0.upto(n - 1) do |j|</code>
        </li>
      
        <li class="covered" data-hits="29472" data-linenumber="38">
          <span class="hits">29472</span>
          
          <code class="ruby">        xr[j] = centroid[j] + @rho * (centroid[j] - x_worst[j])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="40">
          <span class="hits">8209</span>
          
          <code class="ruby">      reflected = PointValuePair.new(xr, f(xr))</code>
        </li>
      
        <li class="covered" data-hits="8209" data-linenumber="41">
          <span class="hits">8209</span>
          
          <code class="ruby">      if ((compare(best, reflected) &lt;= 0) &amp;&amp; (compare(reflected, secondBest) &lt; 0))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">        # accept the reflected point</code>
        </li>
      
        <li class="covered" data-hits="1180" data-linenumber="43">
          <span class="hits">1180</span>
          
          <code class="ruby">        replace_worst_point(reflected)</code>
        </li>
      
        <li class="covered" data-hits="7029" data-linenumber="44">
          <span class="hits">7029</span>
          
          <code class="ruby">      elsif (compare(reflected, best) &lt; 0)</code>
        </li>
      
        <li class="covered" data-hits="352" data-linenumber="45">
          <span class="hits">352</span>
          
          <code class="ruby">        xe = Array.new(n)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">        # compute the expansion point</code>
        </li>
      
        <li class="covered" data-hits="352" data-linenumber="47">
          <span class="hits">352</span>
          
          <code class="ruby">        0.upto(n - 1) do |j|</code>
        </li>
      
        <li class="covered" data-hits="1454" data-linenumber="48">
          <span class="hits">1454</span>
          
          <code class="ruby">          xe[j] = centroid[j] + @khi * (xr[j] - centroid[j])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="352" data-linenumber="50">
          <span class="hits">352</span>
          
          <code class="ruby">        expanded = PointValuePair.new(xe, f(xe))</code>
        </li>
      
        <li class="covered" data-hits="352" data-linenumber="51">
          <span class="hits">352</span>
          
          <code class="ruby">        if (compare(expanded, reflected) &lt; 0)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">          # accept the expansion point</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="53">
          <span class="hits">88</span>
          
          <code class="ruby">          replace_worst_point(expanded)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">          # accept the reflected point</code>
        </li>
      
        <li class="covered" data-hits="264" data-linenumber="56">
          <span class="hits">264</span>
          
          <code class="ruby">          replace_worst_point(reflected)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="6677" data-linenumber="59">
          <span class="hits">6677</span>
          
          <code class="ruby">        if (compare(reflected, worst) &lt; 0)</code>
        </li>
      
        <li class="covered" data-hits="807" data-linenumber="60">
          <span class="hits">807</span>
          
          <code class="ruby">          xc = Array.new(n)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">          # perform an outside contraction</code>
        </li>
      
        <li class="covered" data-hits="807" data-linenumber="62">
          <span class="hits">807</span>
          
          <code class="ruby">          0.upto(n - 1) do |j|</code>
        </li>
      
        <li class="covered" data-hits="2825" data-linenumber="63">
          <span class="hits">2825</span>
          
          <code class="ruby">            xc[j] = centroid[j] + @gamma * (xr[j] - centroid[j])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="807" data-linenumber="65">
          <span class="hits">807</span>
          
          <code class="ruby">          out_contracted = PointValuePair.new(xc, f(xc))</code>
        </li>
      
        <li class="covered" data-hits="807" data-linenumber="66">
          <span class="hits">807</span>
          
          <code class="ruby">          if (compare(out_contracted, reflected) &lt;= 0)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">            # accept the contraction point</code>
        </li>
      
        <li class="covered" data-hits="802" data-linenumber="68">
          <span class="hits">802</span>
          
          <code class="ruby">            replace_worst_point(out_contracted)</code>
        </li>
      
        <li class="covered" data-hits="802" data-linenumber="69">
          <span class="hits">802</span>
          
          <code class="ruby">            return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="5870" data-linenumber="72">
          <span class="hits">5870</span>
          
          <code class="ruby">          xc = Array.new(n)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">          # perform an inside contraction</code>
        </li>
      
        <li class="covered" data-hits="5870" data-linenumber="74">
          <span class="hits">5870</span>
          
          <code class="ruby">          0.upto(n - 1) do |j|</code>
        </li>
      
        <li class="covered" data-hits="20295" data-linenumber="75">
          <span class="hits">20295</span>
          
          <code class="ruby">            xc[j] = centroid[j] - @gamma * (centroid[j] - x_worst[j])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="5870" data-linenumber="77">
          <span class="hits">5870</span>
          
          <code class="ruby">          in_contracted = PointValuePair.new(xc, f(xc))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5870" data-linenumber="79">
          <span class="hits">5870</span>
          
          <code class="ruby">          if (compare(in_contracted, worst) &lt; 0)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">            # accept the contraction point</code>
        </li>
      
        <li class="covered" data-hits="5818" data-linenumber="81">
          <span class="hits">5818</span>
          
          <code class="ruby">            replace_worst_point(in_contracted)</code>
        </li>
      
        <li class="covered" data-hits="5818" data-linenumber="82">
          <span class="hits">5818</span>
          
          <code class="ruby">            return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">        # perform a shrink</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="86">
          <span class="hits">57</span>
          
          <code class="ruby">        x_smallest = @simplex[0].point</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="87">
          <span class="hits">57</span>
          
          <code class="ruby">        0.upto(@simplex.length - 1) do |i|</code>
        </li>
      
        <li class="covered" data-hits="280" data-linenumber="88">
          <span class="hits">280</span>
          
          <code class="ruby">          x = @simplex[i].get_point_clone</code>
        </li>
      
        <li class="covered" data-hits="280" data-linenumber="89">
          <span class="hits">280</span>
          
          <code class="ruby">          0.upto(n - 1) do |j|</code>
        </li>
      
        <li class="covered" data-hits="1118" data-linenumber="90">
          <span class="hits">1118</span>
          
          <code class="ruby">            x[j] = x_smallest[j] + @sigma * (x[j] - x_smallest[j])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="280" data-linenumber="92">
          <span class="hits">280</span>
          
          <code class="ruby">          @simplex[i] = PointValuePair.new(x, Float::NAN)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="94">
          <span class="hits">57</span>
          
          <code class="ruby">        evaluate_simplex</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">  end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0774b99fd307926143922fcb5da8aad0816778a4">
  <div class="header">
    <h3>app/models/concerns/point_value_pair.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby">  # class which holds the point,value pair</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class PointValuePair</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader   :value</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_accessor :value</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader   :point</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    # == Parameters:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    # * &lt;tt&gt;point&lt;/tt&gt;: Coordinates of the point</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    # * &lt;tt&gt;value&lt;/tt&gt;: Function value at the point</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    #</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(point, value)</code>
        </li>
      
        <li class="covered" data-hits="53615" data-linenumber="12">
          <span class="hits">53615</span>
          
          <code class="ruby">      @point = point.clone</code>
        </li>
      
        <li class="covered" data-hits="53615" data-linenumber="13">
          <span class="hits">53615</span>
          
          <code class="ruby">      @value  = value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # returns a copy of the point</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_point_clone</code>
        </li>
      
        <li class="covered" data-hits="280" data-linenumber="18">
          <span class="hits">280</span>
          
          <code class="ruby">      return @point.clone</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="33df51cec7b01d7f10ec8c66d3c2bfd467caaa8f">
  <div class="header">
    <h3>app/models/concerns/user_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module UserHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def scores_for(emotion_prototype, start_time, end_time)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="4">
          <span class="hits">31</span>
          
          <code class="ruby">    journal_entries.scores_for(emotion_prototype, start_time, end_time)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def formatted_scores_for(emotion_prototype, start_time, end_time)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">      emotion_prototype.name =&gt; {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">        color: emotion_prototype.color,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">        scores: scores_for(emotion_prototype, start_time, end_time)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="13">
          <span class="hits">18</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def chart_emotion_data(start_time, end_time, emotion_protos=nil)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="17">
          <span class="hits">6</span>
          
          <code class="ruby">    emotion_protos ||= emotion_prototypes.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    {id =&gt; emotion_protos.reduce({}) do |acc, emotion_prototype|</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="19">
          <span class="hits">18</span>
          
          <code class="ruby">      acc.merge(formatted_scores_for(emotion_prototype, start_time, end_time))</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="20">
          <span class="hits">6</span>
          
          <code class="ruby">    end}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def journal_entries?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="24">
          <span class="hits">3</span>
          
          <code class="ruby">    journal_entries.count &gt; 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def scores_for_emp_with_endpoints(emotion_prototype, start_time, end_time)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="28">
          <span class="hits">11</span>
          
          <code class="ruby">    scores = scores_for(emotion_prototype, start_time, end_time)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="29">
          <span class="hits">11</span>
          
          <code class="ruby">    left = journal_entries.closest_entry_to(start_time)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="30">
          <span class="hits">11</span>
          
          <code class="ruby">    right = journal_entries.closest_entry_to(end_time)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="32">
          <span class="hits">11</span>
          
          <code class="ruby">    left_em = left.emotions.find_by(emotion_prototype: emotion_prototype)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="33">
          <span class="hits">11</span>
          
          <code class="ruby">    right_em = right.emotions.find_by(emotion_prototype: emotion_prototype)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="35">
          <span class="hits">11</span>
          
          <code class="ruby">    scores += [{created_at: start_time, score: left_em.score, tag: left.tag},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">               {created_at: end_time, score: right_em.score, tag: right.tag}]</code>
        </li>
      
        <li class="covered" data-hits="59" data-linenumber="37">
          <span class="hits">59</span>
          
          <code class="ruby">    scores.sort_by{|score| score[:created_at]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="983bc9d9b9feb0b3ab278dc6fdeb38f99ba9a55f">
  <div class="header">
    <h3>app/models/curve_fit.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># require &#39;app/models/minimization/nelder_mead.rb&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">class CurveFit</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def best_fit(n, extracted_scores)</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="4">
          <span class="hits">68</span>
          
          <code class="ruby">    initial_theta = (0..n).to_a.map{|i| rand(-1.0..1.0)}</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="5">
          <span class="hits">14</span>
          
          <code class="ruby">    j = cost(extracted_scores)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="6">
          <span class="hits">14</span>
          
          <code class="ruby">    min = NelderMead.minimize(j,initial_theta)</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="7">
          <span class="hits">68</span>
          
          <code class="ruby">    min.x_minimum.map{|i| i.round(2)}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def cost(extracted_scores)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="11">
          <span class="hits">16</span>
          
          <code class="ruby">    Proc.new do |theta|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      extracted_scores.reduce(0) do |acc, score|</code>
        </li>
      
        <li class="covered" data-hits="234162" data-linenumber="13">
          <span class="hits">234162</span>
          
          <code class="ruby">        acc + (hyp[theta][score[:x]] - score[:y])**2</code>
        </li>
      
        <li class="covered" data-hits="53269" data-linenumber="14">
          <span class="hits">53269</span>
          
          <code class="ruby">      end/(2 * extracted_scores.count.to_f)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def extract_time_score(scores)</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="19">
          <span class="hits">54</span>
          
          <code class="ruby">    scores.map{|score| {x: score[:created_at].to_i, y: score[:score]}}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def hyp</code>
        </li>
      
        <li class="covered" data-hits="234176" data-linenumber="23">
          <span class="hits">234176</span>
          
          <code class="ruby">    Proc.new do |theta|</code>
        </li>
      
        <li class="covered" data-hits="234176" data-linenumber="24">
          <span class="hits">234176</span>
          
          <code class="ruby">      Proc.new do |x|</code>
        </li>
      
        <li class="covered" data-hits="234784" data-linenumber="25">
          <span class="hits">234784</span>
          
          <code class="ruby">        theta.each_index.reduce(0) do |acc, i|</code>
        </li>
      
        <li class="covered" data-hits="934994" data-linenumber="26">
          <span class="hits">934994</span>
          
          <code class="ruby">          acc + (theta[i])*(x**i)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def best_curve(n, extracted_scores)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="33">
          <span class="hits">11</span>
          
          <code class="ruby">    hyp[best_fit(n, extracted_scores)]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def translate_curve_left(lam, val) #val &gt; 0</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="37">
          <span class="hits">6</span>
          
          <code class="ruby">    Proc.new{|x| lam[x+val]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def distance_between_curves(t0, t1, f, g)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="41">
          <span class="hits">7</span>
          
          <code class="ruby">    Integration.integrate(t0, t1, {:tolerance=&gt;0.01,:method=&gt;:simpson}) do |x|</code>
        </li>
      
        <li class="covered" data-hits="350" data-linenumber="42">
          <span class="hits">350</span>
          
          <code class="ruby">        (f[x]-g[x]).abs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1ba3280223f0885a80b98280b347ec914a620c3c">
  <div class="header">
    <h3>app/models/emotion.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Emotion &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :journal_entry</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :emotion_prototype</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def name</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="6">
          <span class="hits">42</span>
          
          <code class="ruby">    emotion_prototype.name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def color</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="10">
          <span class="hits">3</span>
          
          <code class="ruby">    emotion_prototype.color</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def description</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="14">
          <span class="hits">3</span>
          
          <code class="ruby">    emotion_prototype.description</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.scores_to_hash</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="18">
          <span class="hits">7</span>
          
          <code class="ruby">    all.reduce({}) do |acc, emotion|</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="19">
          <span class="hits">32</span>
          
          <code class="ruby">      acc.merge({emotion.name =&gt; emotion.score})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="99fd207cd5fb836c5ce1cfca3f99055b778bb8d0">
  <div class="header">
    <h3>app/models/emotion_prototype.rb</h3>
    <h4><span class="yellow">87.5 %</span> covered</h4>
    <div>
      <b>8</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class EmotionPrototype &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :name, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_associated :user_emotion_prototypes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :user_emotion_prototypes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :users, through: :user_emotion_prototypes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :emotions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_data(user)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">    users.find_by(id: user_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9ef4d76889804f68a431d894bc60010255b93c14">
  <div class="header">
    <h3>app/models/google_service.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class GoogleService</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :auth_client, :drive, :user_info, :access_token</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(auth, opts)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="5">
          <span class="hits">7</span>
          
          <code class="ruby">    @auth_client = auth.client</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="6">
          <span class="hits">7</span>
          
          <code class="ruby">    @user_info = opts[&quot;user_info&quot;]</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="7">
          <span class="hits">7</span>
          
          <code class="ruby">    if auth_client.access_token</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="8">
          <span class="hits">5</span>
          
          <code class="ruby">      set_drive</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="9">
          <span class="hits">5</span>
          
          <code class="ruby">      set_user_info</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_drive</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="14">
          <span class="hits">5</span>
          
          <code class="ruby">    drive = Google::Apis::DriveV2::DriveService.new</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="15">
          <span class="hits">5</span>
          
          <code class="ruby">    drive.authorization = auth_client</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="16">
          <span class="hits">5</span>
          
          <code class="ruby">    @drive = drive</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_user_info</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="20">
          <span class="hits">5</span>
          
          <code class="ruby">    @user_info ||= user_params(drive.get_about.user)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_params(user)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">               &quot;name&quot; =&gt; user.display_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">              &quot;email&quot; =&gt; user.email_address,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      &quot;permission_id&quot; =&gt; user.permission_id</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="28">
          <span class="hits">5</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_file(title)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="32">
          <span class="hits">4</span>
          
          <code class="ruby">    Google::Apis::DriveV2::File.new(title: title, folder: &quot;journal&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="63fc95386bf76e71371fa3e738aaa8a1450b4d95">
  <div class="header">
    <h3>app/models/journal_entry.rb</h3>
    <h4><span class="green">94.74 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class JournalEntry &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :emotions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def datetime</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="6">
          <span class="hits">5</span>
          
          <code class="ruby">    &quot;#{created_at.month}/#{created_at.day}/#{created_at.year} #{created_at.hour}h&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.net_data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    all.reduce({}) do |acc, je|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="11">
          <span class="hits">9</span>
          
          <code class="ruby">      acc.merge(je.emotions.scores_to_hash){|k,v1,v2| v1 + v2}</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="12">
          <span class="hits">5</span>
          
          <code class="ruby">    end.merge({&quot;total&quot; =&gt; count})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def mem_emotions</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="16">
          
          
          <code class="ruby">    @mem ||= emotions.includes(:emotion_prototype)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def prior_week_entries</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="20">
          <span class="hits">5</span>
          
          <code class="ruby">    JournalEntry.where(&quot;created_at &gt;= :start_date AND created_at &lt;= :end_date&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    {start_date: created_at-7.day, end_date: created_at})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.closest_entry_to(time)</code>
        </li>
      
        <li class="covered" data-hits="226" data-linenumber="25">
          <span class="hits">226</span>
          
          <code class="ruby">    all.sort_by{|je| (je.created_at - time)**2}.first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.scores_for(emotion_prototype, start_time, end_time)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="29">
          <span class="hits">31</span>
          
          <code class="ruby">    entries = order(:created_at).where(&quot;created_at &gt;= :start_time AND created_at &lt;= :end_time&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    {start_time: start_time, end_time: end_time})</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="31">
          <span class="hits">31</span>
          
          <code class="ruby">    entries.map do |je|</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="32">
          <span class="hits">66</span>
          
          <code class="ruby">      next unless emp = je.emotions.find_by(emotion_prototype: emotion_prototype)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">        created_at: je.created_at,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">        score: emp.score,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">        tag: je.tag</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="37">
          <span class="hits">66</span>
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4c8245a3bb44644fd9e2af3996b5ba3caa3ec28b">
  <div class="header">
    <h3>app/models/permission_service.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PermissionService</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :user, :controller, :action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(user)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="5">
          <span class="hits">33</span>
          
          <code class="ruby">    @user = user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def allow?(controller, action)</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="9">
          <span class="hits">33</span>
          
          <code class="ruby">    @controller = controller</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="10">
          <span class="hits">33</span>
          
          <code class="ruby">    @action = action</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    case</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="13">
          <span class="hits">27</span>
          
          <code class="ruby">    when user then user_permissions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="15">
          <span class="hits">6</span>
          
          <code class="ruby">      logged_out_permissions</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="16">
          <span class="hits">33</span>
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_permissions</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="22">
          <span class="hits">27</span>
          
          <code class="ruby">    return [true, :ok] if controller == &quot;dashboards&quot;</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="23">
          <span class="hits">19</span>
          
          <code class="ruby">    return [true, :ok] if controller == &quot;sessions&quot;</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="24">
          <span class="hits">19</span>
          
          <code class="ruby">    return [true, :ok] if controller == &quot;journal_entries&quot;</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="25">
          <span class="hits">12</span>
          
          <code class="ruby">    return [true, :ok] if controller == &quot;api/v1/journal_entries&quot;</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="26">
          <span class="hits">7</span>
          
          <code class="ruby">    return [true, :ok] if controller == &quot;api/v1/alert_analytics&quot;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="27">
          <span class="hits">6</span>
          
          <code class="ruby">    return [true, :ok] if controller == &quot;api/v1/emotions&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    [false, &quot;/dashboard&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def logged_out_permissions</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="32">
          <span class="hits">6</span>
          
          <code class="ruby">    return [true, :ok] if controller == &quot;home&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="33">
          <span class="hits">4</span>
          
          <code class="ruby">    return [true, :ok] if controller == &quot;sessions&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    [false, &quot;/&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="285730d87c85f41879232d74b034564f622bb167">
  <div class="header">
    <h3>app/models/reddit_miner.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>25</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RedditMiner</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def get(subreddit, filter, params)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="3">
          <span class="hits">5</span>
          
          <code class="ruby">    uri = URI(&quot;http://www.reddit.com/r/#{subreddit}/#{filter}.json?#{params}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="4">
          <span class="hits">5</span>
          
          <code class="ruby">    req = Net::HTTP::Get.new(uri)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="5">
          <span class="hits">5</span>
          
          <code class="ruby">    res = Net::HTTP.start(uri.hostname, uri.port) {|http|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="6">
          <span class="hits">5</span>
          
          <code class="ruby">      http.request(req)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="8">
          <span class="hits">5</span>
          
          <code class="ruby">    JSON.parse(res.body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def process(reddit_reply)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="12">
          <span class="hits">5</span>
          
          <code class="ruby">    posts = reddit_reply[&quot;data&quot;][&quot;children&quot;].map do |post_json|</code>
        </li>
      
        <li class="covered" data-hits="500" data-linenumber="13">
          <span class="hits">500</span>
          
          <code class="ruby">        build_post(post_json[&quot;data&quot;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      children: posts,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      before: reddit_reply[&quot;data&quot;][&quot;before&quot;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      after: reddit_reply[&quot;data&quot;][&quot;after&quot;]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="20">
          <span class="hits">5</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def process_single(subreddit, filter, params)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="24">
          <span class="hits">5</span>
          
          <code class="ruby">    process(get(subreddit, filter, params))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def process_many(subreddit, filter, api_calls, start_at = nil)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="28">
          <span class="hits">4</span>
          
          <code class="ruby">    posts, initial_params = [], &quot;limit=100&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="29">
          <span class="hits">4</span>
          
          <code class="ruby">    initial_params += &quot;&amp;after=#{start_at}&quot; if start_at</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="30">
          <span class="hits">4</span>
          
          <code class="ruby">    reply = process_single(subreddit, filter, initial_params)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="31">
          <span class="hits">4</span>
          
          <code class="ruby">    posts += reply[:children]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="32">
          <span class="hits">4</span>
          
          <code class="ruby">    (api_calls-1).times do |i|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      puts i</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      reply = process_single(subreddit, filter, &quot;limit=100&amp;after=#{reply[:after]}&quot;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      posts += reply[:children]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="37">
          <span class="hits">4</span>
          
          <code class="ruby">    {posts: posts.uniq, continue_at: reply[:after]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_post(post_params)</code>
        </li>
      
        <li class="covered" data-hits="500" data-linenumber="41">
          <span class="hits">500</span>
          
          <code class="ruby">    OpenStruct.new(post_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fbeafc0cd74a88601ee9ae1527a099eab1b611a7">
  <div class="header">
    <h3>app/models/reflective_similarity.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ReflectiveSimilarity</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :cf</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="5">
          <span class="hits">3</span>
          
          <code class="ruby">    @cf = CurveFit.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def entries_to_translated_curve(emotion_prototype, start_time, interval, user)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="9">
          <span class="hits">9</span>
          
          <code class="ruby">    scores = user.scores_for_emp_with_endpoints(emotion_prototype, start_time, start_time + interval)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="10">
          <span class="hits">9</span>
          
          <code class="ruby">    extracted_scores = translate_scale_extracted_scores(cf.extract_time_score(scores), start_time.to_i, interval.to_i)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="11">
          <span class="hits">9</span>
          
          <code class="ruby">    n = [[extracted_scores.count - 1 , 7].min, 0].max</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="12">
          <span class="hits">9</span>
          
          <code class="ruby">    cf.best_curve(n, extracted_scores)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def translate_scale_extracted_scores(extracted_scores, start_time, interval)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="16">
          <span class="hits">9</span>
          
          <code class="ruby">    extracted_scores.map do |score|</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="17">
          <span class="hits">40</span>
          
          <code class="ruby">      {x: (score[:x] - start_time)/(interval.to_f), y: score[:y]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1e93be816a1a1ee9e174628439e95dbdc9a57c92">
  <div class="header">
    <h3>app/models/save_to_drive_service.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SaveToDriveService</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :file_name, :google_service</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(google_service, user_id)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="5">
          <span class="hits">4</span>
          
          <code class="ruby">    @file_name = &quot;entry#{user_id}.txt&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="6">
          <span class="hits">4</span>
          
          <code class="ruby">    @google_service = google_service</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_file(tag)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="10">
          <span class="hits">4</span>
          
          <code class="ruby">    google_service.create_file(tag)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def save_file_locally(body)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">    File.write(file_name, body)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_to_drive(file)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="18">
          <span class="hits">4</span>
          
          <code class="ruby">    google_service.drive.insert_file(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">        file,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        upload_source: file_name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        content_type: &#39;text/plain&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def delete_local_file</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="26">
          <span class="hits">4</span>
          
          <code class="ruby">    File.delete(file_name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_file_to_drive(tag, body)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="30">
          <span class="hits">4</span>
          
          <code class="ruby">    file = create_file(tag)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="31">
          <span class="hits">4</span>
          
          <code class="ruby">    save_file_locally(body)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="32">
          <span class="hits">4</span>
          
          <code class="ruby">    reply = send_to_drive(file)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="33">
          <span class="hits">4</span>
          
          <code class="ruby">    delete_local_file</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="34">
          <span class="hits">4</span>
          
          <code class="ruby">    reply</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e81a6ea459c640d5b35dafd537985684808462ef">
  <div class="header">
    <h3>app/models/self_reflection.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>21</b> relevant lines. 
      <span class="green"><b>21</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SelfReflection</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :user, :refl</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(user)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    @user = user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    @refl = ReflectiveSimilarity.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def distances_between_journal_and_journal_span(emotion_prototype, interval)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    i=0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    end_time = Time.now - interval</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    current_curve = refl.entries_to_translated_curve(emotion_prototype,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">                                                      end_time,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">                                                     interval,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">                                                     user)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    past_curves(emotion_prototype, end_time, interval).map do |curve|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="18">
          <span class="hits">6</span>
          
          <code class="ruby">      puts &quot;working: #{i}&quot;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="19">
          <span class="hits">6</span>
          
          <code class="ruby">      i+=1</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="20">
          <span class="hits">6</span>
          
          <code class="ruby">      [refl.cf.distance_between_curves(0, 1, current_curve, curve[0]), curve[1]]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    end.sort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def past_curves(emotion_prototype, end_time, interval)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    t0 = user.first_entry_date</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    curves = []</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="27">
          <span class="hits">8</span>
          
          <code class="ruby">    while (t0 + interval).to_i &lt; end_time.to_i</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="28">
          <span class="hits">6</span>
          
          <code class="ruby">      puts &quot;t1: #{t0 + interval},  end_time: #{end_time.to_i}&quot;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="29">
          <span class="hits">6</span>
          
          <code class="ruby">      curves &lt;&lt; [refl.entries_to_translated_curve(emotion_prototype, t0, interval, user) , t0]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="30">
          <span class="hits">6</span>
          
          <code class="ruby">      t0 += 1.day</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    curves</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"># 1. Methods for, given a week timeframe, create false data points on the edges: id closest posts in time, take their score for the emotion.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"># 2. Given a timeframe augmented by endpoints as above, best fit 5d-7d polynomial to the weeks data points.  Need cost function for 7d poly and variable length training set.  This uses the minimization gem.  e.g</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"># 		f = proc{ |x| (x[0] - @p[0])**2 + (x[1] - @p[1])**2 + (x[2] - @p[2])**2 }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"># 		@min1 = Minimization::NelderMead.minimize(f, @start_point)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"># 	We want f = proc{|theta| sum_i((poly_theta(xi) - yi)**2)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"># 	This returns theta vector of best fitting curve.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"># 3. Perform step 2 on most recent week.  Then begin at the first journal entry in time, and proceed as follows.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">#     1. Compute step 2 on the current week.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">#     2. let f be the proc corresponding to the best fit curve for current week, and g the proc for best fit curve to week examined.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">#     3. h = Proc.new {|x| [f[x],g[x]].max}, j = Proc.new{|x| [f[x],g[x]].min}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">#     4. Integrate h-j over the time ranges of the week. e.g</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">#     5. Integration.integrate(time_0, time_1, {:tolerance=&gt;1e-10,:method=&gt;:simpson}) {|x| h[x]-j[x]}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">#     6. Store this number in an array and repeat this process one day later</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">#     7. Stop when the right end point is the left end point of the current week</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">#     8. the LOWEST numbers in the array represent the most similar time periods for that emotion.</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="58f1e469745e4a03f8240fe8cb26010f49c66a25">
  <div class="header">
    <h3>app/models/suicidal_entry_classifier.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>16</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SuicidalEntryClassifier</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_reader :entry_data, :bayes_classifier, :sentiment_analyzer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(post_with_data)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="5">
          <span class="hits">9</span>
          
          <code class="ruby">    Sentimental.load_defaults</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="6">
          <span class="hits">9</span>
          
          <code class="ruby">    @sentiment_analyzer = Sentimental.new(0.1)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="7">
          <span class="hits">9</span>
          
          <code class="ruby">    @bayes_classifier = BayesSuicideClassifier.new</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="8">
          <span class="hits">9</span>
          
          <code class="ruby">    @entry_data = post_with_data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def troubled_past_week?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="12">
          <span class="hits">4</span>
          
          <code class="ruby">    entry_data = JournalEntry.last.prior_week_entries.net_data</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="13">
          <span class="hits">4</span>
          
          <code class="ruby">    4*entry_data[&quot;content&quot;] + 2*entry_data[&quot;happy&quot;] &lt; entry_data[&quot;sad&quot;] + entry_data[&quot;angry&quot;] + entry_data[&quot;anxious&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def troubled_classification?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="17">
          <span class="hits">4</span>
          
          <code class="ruby">    {&quot;Ok&quot; =&gt; false, &quot;Troubled&quot; =&gt; true}[bayes_classifier.classify entry_data[&quot;body&quot;]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def troubled_sentiment?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      :neutral =&gt; false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      :positive =&gt; false,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      :negative =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="25">
          <span class="hits">4</span>
          
          <code class="ruby">    }[sentiment_analyzer.get_sentiment(entry_data[&quot;body&quot;])]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def troubled?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="29">
          <span class="hits">2</span>
          
          <code class="ruby">    troubled_past_week? &amp;&amp; troubled_classification? &amp;&amp; troubled_sentiment?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="33b97087ab77bae8f8b59345185cfda1e47c367c">
  <div class="header">
    <h3>app/models/training_post.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class TrainingPost &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.get_training_posts(subreddit, filter, api_calls, tag, continue_at = nil)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="3">
          <span class="hits">4</span>
          
          <code class="ruby">    puts &quot;mining from #{subreddit}/#{filter}&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="4">
          <span class="hits">4</span>
          
          <code class="ruby">    puts &quot;Initial TrainingPosts count: #{TrainingPost.count}&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="5">
          <span class="hits">4</span>
          
          <code class="ruby">    posts_next = RedditMiner.new.process_many(subreddit, filter, api_calls)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="6">
          <span class="hits">4</span>
          
          <code class="ruby">    posts_next[:posts].each do |post|</code>
        </li>
      
        <li class="covered" data-hits="500" data-linenumber="7">
          <span class="hits">500</span>
          
          <code class="ruby">      next if post.selftext.split.count &lt; 20</code>
        </li>
      
        <li class="covered" data-hits="82" data-linenumber="8">
          <span class="hits">82</span>
          
          <code class="ruby">      TrainingPost.find_or_create_by(entry: post.selftext, classification: tag)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="10">
          <span class="hits">4</span>
          
          <code class="ruby">    puts &quot;Unique posts gathered from Reddit: #{posts_next[:posts].count}&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">    puts &quot;Final TrainingPosts count: #{TrainingPost.count} &quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="12">
          <span class="hits">4</span>
          
          <code class="ruby">    posts_next[:continue_at]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ad590ca49807d86a550427908d38999572c9695a">
  <div class="header">
    <h3>app/models/user.rb</h3>
    <h4><span class="green">93.55 %</span> covered</h4>
    <div>
      <b>31</b> relevant lines. 
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class User &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include UserHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :journal_entries</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :user_emotion_prototypes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :emotion_prototypes, through: :user_emotion_prototypes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :app_messages</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find_or_create_by_auth(opts)</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="9">
          <span class="hits">32</span>
          
          <code class="ruby">    user = User.find_or_create_by(email: opts[&quot;email&quot;])</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="10">
          <span class="hits">32</span>
          
          <code class="ruby">    user.name = opts[&quot;name&quot;] if opts[&quot;name&quot;]</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="11">
          <span class="hits">32</span>
          
          <code class="ruby">    user.permission_id = opts[&quot;permission_id&quot;] if opts[&quot;permission_id&quot;]</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="12">
          <span class="hits">32</span>
          
          <code class="ruby">    user.emotion_prototypes = User.basic_emotion_prototypes if user.emotion_prototypes.empty?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="13">
          <span class="hits">32</span>
          
          <code class="ruby">    user.save</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="14">
          <span class="hits">32</span>
          
          <code class="ruby">    user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.basic_emotion_prototypes</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="18">
          <span class="hits">32</span>
          
          <code class="ruby">    User.find_by(email: &quot;basic_emotion_prototypes&quot;).emotion_prototypes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def active_emotion_prototypes</code>
        </li>
      
        <li class="covered" data-hits="147" data-linenumber="22">
          <span class="hits">147</span>
          
          <code class="ruby">    user_emotion_prototypes.where(status: &quot;active&quot;).map{|x| x.emotion_prototype}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def inactive_emotion_prototypes</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="26">
          <span class="hits">24</span>
          
          <code class="ruby">    user_emotion_prototypes.where(status: &quot;inactive&quot;).map{|x| x.emotion_prototype}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_emotion_prototype(status, name)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="30">
          <span class="hits">15</span>
          
          <code class="ruby">    emp = user_emotion_prototypes.find{|x| x.emotion_prototype.name == name}</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="31">
          <span class="hits">5</span>
          
          <code class="ruby">    emp.status = status</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="32">
          <span class="hits">5</span>
          
          <code class="ruby">    emp.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def first_entry_date</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="36">
          <span class="hits">3</span>
          
          <code class="ruby">    (@fed ||= journal_entries.order(:created_at).first.created_at) unless journal_entries.to_a.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def last_entry_date</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="40">
          <span class="hits">2</span>
          
          <code class="ruby">    (@led ||= journal_entries.order(:created_at).last.created_at) unless journal_entries.to_a.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def mem_journal_entries</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">    @mje ||= journal_entries.includes(:emotions)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_journal_entries?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="48">
          
          
          <code class="ruby">    !journal_entries.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="05b0afe9e93fb9bf50d93ae78ca1a8c0051ae847">
  <div class="header">
    <h3>app/models/user_emotion_prototype.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class UserEmotionPrototype &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :emotion_prototype</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  # validate :unique_name_per_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  #</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  # def unique_name_per_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  #   users_emotion_names = UserEmotionPrototype.where(id: user.id).all.map{|x| x.emotion_prototype.name}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  #   if users_emotion_names.include?(emotion_prototype.name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  #     errors.add(:name, &quot;already taken!&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  #   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  # end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
